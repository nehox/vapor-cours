# docker-compose.dev.yml - Configuration Docker Compose pour le dÃ©veloppement
# Utilisation : docker-compose -f docker-compose.dev.yml up

services:
  vapor-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8080:8080"
    volumes:
      # Monte le code source local dans le conteneur
      # Permet le hot reload - les changements sont reflÃ©tÃ©s immÃ©diatement
      - .:/app
      # Exclut le dossier .build pour Ã©viter les conflits
      - /app/.build
    working_dir: /app
    environment:
      - LOG_LEVEL=debug
      - ENVIRONMENT=development
    # RedÃ©marre automatiquement en cas d'erreur
    restart: unless-stopped
    # Commande personnalisÃ©e avec surveillance des changements
    command: >
      bash -c "
        echo 'ğŸ”¥ DÃ©marrage du serveur de dÃ©veloppement avec hot reload...' &&
        echo 'ğŸ“ RÃ©pertoire de travail : /app' &&
        echo 'ğŸŒ Serveur disponible sur : http://localhost:8080' &&
        echo 'ğŸ“ Modifiez vos fichiers Swift - le serveur redÃ©marrera automatiquement !' &&
        swift run
      "

  # Service optionnel pour la base de donnÃ©es (si besoin d'une vraie DB plus tard)
  # db:
  #   image: postgres:13
  #   environment:
  #     POSTGRES_DB: vapor_tasks
  #     POSTGRES_USER: vapor
  #     POSTGRES_PASSWORD: password
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data

# volumes:
#   postgres_data:
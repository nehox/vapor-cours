# Docker Compose pour le dÃ©veloppement Swift/Vapor
version: '3.8'

services:
  # ===========================
  # ğŸ› ï¸ Environnement de dÃ©veloppement Swift
  # ===========================
  swift-dev:
    image: swift:5.9-jammy
    container_name: vapor-dev
    working_dir: /app
    volumes:
      # Monter le code source
      - .:/app
      # Cache pour les dÃ©pendances Swift
      - swift-cache:/app/.build
    ports:
      - "8080:8080"
    environment:
      - LOG_LEVEL=debug
    # Commande pour installer les dÃ©pendances et dÃ©marrer en mode watch
    command: >
      bash -c "
      echo 'ğŸš€ DÃ©marrage de l environnement de dÃ©veloppement Swift/Vapor' &&
      echo 'ğŸ“¦ Installation des dÃ©pendances...' &&
      swift package resolve &&
      echo 'ğŸ”¨ Compilation...' &&
      swift build &&
      echo 'âœ… DÃ©marrage du serveur sur http://localhost:8080' &&
      swift run App serve --hostname 0.0.0.0 --port 8080
      "
    stdin_open: true
    tty: true

  # ===========================
  # ğŸ—„ï¸ Base de donnÃ©es SQLite (pour visualisation)
  # ===========================
  sqlite-viewer:
    image: coleifer/sqlite-web
    container_name: vapor-sqlite-viewer
    ports:
      - "8081:8080"
    volumes:
      - .:/data
    command: ["sqlite_web", "/data/db.sqlite", "--host", "0.0.0.0", "--port", "8080"]
    depends_on:
      - swift-dev

# ===========================
# ğŸ’¾ Volumes pour la persistance
# ===========================
volumes:
  swift-cache:
    driver: local